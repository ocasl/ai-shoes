# 材质管理API接口文档

## 概述

材质管理API提供了材质文件的上传、查询、下载和删除等功能。支持系统材质库和用户材质库的管理，具有完善的权限控制机制。

**基础路径**: `/material`

**认证方式**: JWT Token (Bearer Token)

## 接口列表

### 1. 上传材质

**接口地址**: `POST /material/upload`

**接口描述**: 上传新的材质文件到系统

**请求方式**: `POST`

**Content-Type**: `multipart/form-data`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| name | String | 是 | 材质名称，会自动清理首尾空格和多余标点符号 |
| type | Integer | 是 | 材质类型：0-系统材质库，1-用户材质库 |
| file | MultipartFile | 是 | 材质文件，支持常见图片格式 |

#### 权限说明

- **系统材质库 (type=0)**: 只有管理员可以上传
- **用户材质库 (type=1)**: 所有登录用户都可以上传

#### 请求示例

```bash
curl -X POST "http://localhost:8080/material/upload" \
  -H "Authorization: Bearer your-jwt-token" \
  -F "name=皮革材质" \
  -F "type=1" \
  -F "file=@/path/to/material.jpg"
```

#### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 123
  }
}
```

**权限不足错误**:
```json
{
  "code": 1030,
  "message": "权限不足",
  "data": null
}
```

**参数错误**:
```json
{
  "code": 400,
  "message": "请求参数不正确",
  "data": null
}
```

---

### 2. 查询材质列表

**接口地址**: `POST /material/list`

**接口描述**: 分页查询材质列表，支持按名称、类型、格式筛选

**请求方式**: `POST`

**Content-Type**: `application/json`

#### 请求参数

```json
{
  "name": "皮革",           // 可选，材质名称（模糊查询）
  "type": 1,              // 可选，材质类型：0-系统材质库，1-用户材质库
  "format": "jpg",        // 可选，文件格式
  "current": 1,           // 可选，当前页码，默认1
  "size": 10              // 可选，每页大小，默认10，最大100
}
```

#### 查询逻辑说明

- **type=0**: 只查询系统材质库
- **type=1**: 只查询用户自己的材质库
- **type=null或其他**: 查询系统材质库 + 用户自己的材质库

#### 请求示例

```bash
curl -X POST "http://localhost:8080/material/list" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-jwt-token" \
  -d '{
    "name": "皮革",
    "type": 1,
    "current": 1,
    "size": 10
  }'
```

#### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "records": [
      {
        "id": 123,
        "name": "皮革材质",
        "ossPath": "materials/user1/leather.jpg",
        "format": "jpg",
        "type": 1,
        "userId": 1,
        "uploadTime": "2024-01-01T10:00:00",
        "downloadCount": 5,
        "createTime": "2024-01-01T10:00:00",
        "updateTime": "2024-01-01T10:00:00",
        "remark": "高质量皮革材质",
        "deleted": 0
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

---

### 3. 获取材质详情

**接口地址**: `GET /material/{id}`

**接口描述**: 根据材质ID获取详细信息

**请求方式**: `GET`

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 材质ID |

#### 请求示例

```bash
curl -X GET "http://localhost:8080/material/123" \
  -H "Authorization: Bearer your-jwt-token"
```

#### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 123,
    "name": "皮革材质",
    "ossPath": "materials/user1/leather.jpg",
    "format": "jpg",
    "type": 1,
    "userId": 1,
    "uploadTime": "2024-01-01T10:00:00",
    "downloadCount": 5,
    "createTime": "2024-01-01T10:00:00",
    "updateTime": "2024-01-01T10:00:00",
    "remark": "高质量皮革材质",
    "deleted": 0
  }
}
```

**材质不存在**:
```json
{
  "code": 1032,
  "message": "材质不存在",
  "data": null
}
```

---

### 4. 下载材质

**接口地址**: `POST /material/download/{id}`

**接口描述**: 获取材质文件的OSS下载链接并增加下载次数

**请求方式**: `POST`

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 材质ID |

#### 请求示例

```bash
curl -X POST "http://localhost:8080/material/download/123" \
  -H "Authorization: Bearer your-jwt-token"
```

#### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "downloadUrl": "https://example.com/materials/user1/leather.jpg",
    "fileName": "皮革材质",
    "format": "jpg"
  }
}
```

**材质不存在**:
```json
{
  "code": 1032,
  "message": "材质不存在",
  "data": null
}
```

---

### 5. 删除材质

**接口地址**: `DELETE /material/{id}`

**接口描述**: 删除指定材质（逻辑删除）。管理员可以删除所有材质，普通用户只能删除自己的材质

**请求方式**: `DELETE`

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 材质ID |

#### 权限说明

- **管理员 (ADMIN)**: 可以删除所有材质
- **普通用户 (MEMBER/VISITOR)**: 只能删除自己上传的材质

#### 请求示例

```bash
curl -X DELETE "http://localhost:8080/material/123" \
  -H "Authorization: Bearer your-jwt-token"
```

#### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": "删除成功"
}
```

**权限不足**:
```json
{
  "code": 1030,
  "message": "权限不足",
  "data": null
}
```

**材质不存在**:
```json
{
  "code": 1032,
  "message": "材质不存在",
  "data": null
}
```

**用户未登录**:
```json
{
  "code": 401,
  "message": "账号未登录",
  "data": null
}
```

---

## 数据模型

### Material (材质实体)

```json
{
  "id": "Long",                    // 材质ID
  "name": "String",                // 材质名称
  "ossPath": "String",             // OSS存储路径
  "format": "String",              // 文件格式
  "type": "Integer",               // 材质类型：0-系统材质库，1-用户材质库
  "userId": "Long",                // 上传用户ID
  "uploadTime": "LocalDateTime",   // 上传时间
  "downloadCount": "Integer",      // 下载次数
  "createTime": "LocalDateTime",   // 创建时间
  "updateTime": "LocalDateTime",   // 更新时间
  "remark": "String",              // 备注
  "deleted": "Integer"             // 是否删除：0-未删除，1-已删除
}
```

### MaterialQueryVO (查询参数)

```json
{
  "name": "String",        // 材质名称（模糊查询）
  "type": "Integer",       // 材质类型
  "format": "String",      // 文件格式
  "current": "Integer",    // 当前页码
  "size": "Integer"        // 每页大小
}
```

### MaterialUploadVO (上传参数)

```json
{
  "name": "String",        // 材质名称
  "type": "Integer",       // 材质类型
  "file": "MultipartFile"  // 材质文件
}
```

---

## 错误码说明

| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 200 | 操作成功 | 请求处理成功 |
| 400 | 请求参数不正确 | 请求参数格式错误或缺少必填参数 |
| 401 | 账号未登录 | 用户未登录或登录状态失效 |
| 403 | 没有该操作权限 | 用户权限不足 |
| 500 | 系统异常 | 服务器内部错误 |
| 1000 | 用户名或密码错误 | 登录失败 |
| 1003 | token验证失败 | JWT Token无效 |
| 1004 | 用户不存在 | 用户信息不存在 |
| 1030 | 权限不足 | 用户权限不足，无法执行操作 |
| 1032 | 材质不存在 | 指定的材质ID不存在 |
| 1033 | 材质删除失败 | 材质删除操作失败 |

---

## 权限控制说明

### 用户角色

- **ADMIN**: 管理员，拥有所有权限
- **MEMBER**: 会员，拥有部分权限
- **VISITOR**: 访客，拥有基础权限

### 权限矩阵

| 操作 | ADMIN | MEMBER | VISITOR | 说明 |
|------|-------|--------|---------|------|
| 上传系统材质 | ✅ | ❌ | ❌ | 只有管理员可以上传到系统材质库 |
| 上传用户材质 | ✅ | ✅ | ✅ | 所有用户都可以上传到自己的材质库 |
| 查询材质列表 | ✅ | ✅ | ✅ | 所有用户都可以查询，但只能看到有权限的材质 |
| 获取材质详情 | ✅ | ✅ | ✅ | 所有用户都可以查看有权限的材质详情 |
| 下载材质 | ✅ | ✅ | ✅ | 所有用户都可以下载有权限的材质 |
| 删除系统材质 | ✅ | ❌ | ❌ | 只有管理员可以删除系统材质 |
| 删除用户材质 | ✅ | 自己的 | ❌ | 管理员可以删除所有，用户只能删除自己的 |

---

## 使用示例

### 完整工作流程

1. **用户登录获取Token**
```bash
curl -X POST "http://localhost:8080/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "user123",
    "password": "password123"
  }'
```

2. **上传材质**
```bash
curl -X POST "http://localhost:8080/material/upload" \
  -H "Authorization: Bearer your-jwt-token" \
  -F "name=皮革材质" \
  -F "type=1" \
  -F "file=@/path/to/material.jpg"
```

3. **查询材质列表**
```bash
curl -X POST "http://localhost:8080/material/list" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-jwt-token" \
  -d '{
    "name": "皮革",
    "type": 1,
    "current": 1,
    "size": 10
  }'
```

4. **下载材质**
```bash
curl -X POST "http://localhost:8080/material/download/123" \
  -H "Authorization: Bearer your-jwt-token"
```

5. **删除材质**
```bash
curl -X DELETE "http://localhost:8080/material/123" \
  -H "Authorization: Bearer your-jwt-token"
```

---

## 注意事项

1. **文件上传限制**: 支持常见图片格式，文件大小限制为10MB
2. **权限验证**: 所有接口都需要有效的JWT Token
3. **逻辑删除**: 删除操作为逻辑删除，不会物理删除文件
4. **下载统计**: 每次下载都会自动增加下载次数
5. **名称清理**: 上传时会自动清理材质名称的首尾空格和多余标点符号
6. **分页查询**: 查询接口支持分页，默认每页10条，最大100条
7. **模糊查询**: 材质名称支持模糊查询
8. **错误处理**: 所有接口都有完善的错误处理和错误码返回

---

## 更新日志

### v1.1.0 (当前版本)
- ✅ 添加管理员删除所有材质权限
- ✅ 完善权限控制逻辑
- ✅ 优化错误处理机制
- ✅ 更新API文档

### v1.0.0
- ✅ 基础材质管理功能
- ✅ 文件上传下载
- ✅ 基础权限控制 