<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMäº¤äº’å¼åˆ†å‰²å·¥å…·</title>
    <!-- ä¸»è¦CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- å¤‡ç”¨CDN - å¦‚æœä¸»è¦CDNå¤±è´¥ -->
    <script>
        // æ£€æŸ¥Vueæ˜¯å¦åŠ è½½æˆåŠŸï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•å¤‡ç”¨CDN
        if (typeof Vue === 'undefined') {
            console.log('ä¸»è¦CDNåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨CDN...');
            document.write('<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"><\/script>');
        }
        
        // æ£€æŸ¥axiosæ˜¯å¦åŠ è½½æˆåŠŸï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•å¤‡ç”¨CDN
        if (typeof axios === 'undefined') {
            console.log('ä¸»è¦CDNåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨CDN...');
            document.write('<script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"><\/script>');
        }
        
        // å¦‚æœä¸¤ä¸ªå¤‡ç”¨CDNéƒ½å¤±è´¥ï¼Œå°è¯•ç¬¬ä¸‰ä¸ªCDN
        setTimeout(function() {
            if (typeof Vue === 'undefined') {
                console.log('å¤‡ç”¨CDNä¹Ÿå¤±è´¥ï¼Œå°è¯•ç¬¬ä¸‰ä¸ªCDN...');
                document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.js"><\/script>');
            }
            if (typeof axios === 'undefined') {
                document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"><\/script>');
            }
        }, 2000);
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .model-info {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .main-content {
            padding: 30px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .panel h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn.active {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            transform: scale(1.05);
        }

        .point-type-buttons {
            display: flex;
            gap: 10px;
        }

        .point-type-buttons .btn {
            flex: 1;
            padding: 12px 8px;
            font-size: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .point-type-buttons .btn:hover {
            transform: translateY(-2px);
        }

        .canvas-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
        }

        .canvas-container h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .canvas-wrapper {
            position: relative;
            display: inline-block;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }

        .canvas-wrapper canvas {
            display: block;
            cursor: crosshair;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }

        .canvas-placeholder {
            width: 400px;
            height: 300px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            color: #6c757d;
            font-size: 1.1em;
            text-align: center;
        }

        .status-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 600;
            color: #495057;
        }

        .status-value {
            color: #6c757d;
        }

        .status-value.success {
            color: #28a745;
        }

        .status-value.error {
            color: #dc3545;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .points-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .points-info h4 {
            margin-bottom: 10px;
            color: #495057;
        }

        .point-count {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            margin-right: 10px;
            font-size: 0.9em;
        }

        .point-count.background {
            background: #6c757d;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>ğŸ¯ SAMäº¤äº’å¼åˆ†å‰²å·¥å…·</h1>
                <p>åŸºäºCanvasçš„å¯è§†åŒ–äº¤äº’ç•Œé¢</p>
            </div>

            <div class="main-content">
                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="control-panel">
                    <div class="panel">
                        <h3>ğŸ“ å›¾åƒä¸Šä¼ </h3>
                        <div class="form-group">
                            <label for="imageFile">é€‰æ‹©å›¾åƒæ–‡ä»¶</label>
                            <input type="file" id="imageFile" @change="handleFileUpload" accept="image/*">
                        </div>
                        <div class="form-group">
                            <label for="maxSize">æœ€å¤§å°ºå¯¸ (px)</label>
                            <input type="number" id="maxSize" v-model="maxSize" min="512" max="2048" step="64">
                        </div>
                        <div class="form-group">
                            <label for="quality">å‹ç¼©è´¨é‡ (%)</label>
                            <input type="number" id="quality" v-model="quality" min="50" max="100" step="5">
                        </div>
                        <div class="form-group" v-if="taskId">
                            <label>å½“å‰ä»»åŠ¡ID</label>
                            <div style="padding: 8px; background: #e9ecef; border-radius: 4px; font-family: monospace;">
                                {{ taskId }}
                            </div>
                        </div>
                        <button class="btn" @click="loadImage" :disabled="!selectedFile || loading">
                            <span v-if="loading" class="loading"></span>
                            {{ loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½å›¾åƒ' }}
                        </button>
                    </div>

                    <div class="panel">
                        <h3>ğŸ¯ åˆ†å‰²æ§åˆ¶</h3>

                        <div class="form-group">
                            <label for="alpha">æ©ç é€æ˜åº¦</label>
                            <input type="range" id="alpha" v-model="alpha" min="0" max="1" step="0.1">
                            <span>{{ alpha }}</span>
                        </div>
                                <div class="form-group">
            <label for="maskAlpha">è’™ç‰ˆé€æ˜åº¦</label>
            <input type="range" id="maskAlpha" v-model="maskAlpha" min="0" max="255" step="25" @input="updateMaskTransparency">
            <span>{{ maskAlpha }}</span>
        </div>
        
                <!-- é…ç½®å¯¹è¯æ¡† -->
        <div v-if="showConfig" class="modal" style="background: rgba(0,0,0,0.5); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">
            <div class="modal-dialog" style="max-width: 500px; margin: 50px auto; background: white; padding: 20px; border-radius: 8px;">
                <h3>æ¨¡å‹é…ç½®</h3>
                <div class="form-group">
                    <label>ç½®ä¿¡åº¦é˜ˆå€¼: {{ config.confidence_threshold }}</label>
                                            <input type="range" v-model="config.confidence_threshold" min="0.1" max="1.0" step="0.01" style="width: 100%;">
                </div>
                <div class="form-group">
                    <label>æ©ç é˜ˆå€¼: {{ config.mask_threshold }}</label>
                                            <input type="range" v-model="config.mask_threshold" min="0.0" max="1.0" step="0.01" style="width: 100%;">
                </div>
                                    <div class="form-group">
                        <label>ç¨³å®šæ€§åˆ†æ•°é˜ˆå€¼: {{ config.stability_score_threshold }}</label>
                        <input type="range" v-model="config.stability_score_threshold" min="0.5" max="1.0" step="0.01" style="width: 100%;">
                    </div>
                    <div class="form-group">
                        <label>æœ€å°é¢ç§¯é˜ˆå€¼: {{ config.min_area_threshold }} (0=è·³è¿‡è¿‡æ»¤)</label>
                        <input type="range" v-model="config.min_area_threshold" min="0" max="10000" step="5" style="width: 100%;">
                    </div>
                <div class="form-group">
                    <label><input type="checkbox" v-model="config.use_hq_token"> ä½¿ç”¨é«˜è´¨é‡token</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" v-model="config.multimask_output"> è¾“å‡ºå¤šä¸ªæ©ç </label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" v-model="config.enable_gpu_preprocessing"> GPUé¢„å¤„ç†</label>
                </div>
                <div class="form-group">
                    <button @click="updateConfig" class="btn btn-primary">ä¿å­˜é…ç½®</button>
                    <button @click="resetToDefault" class="btn btn-warning">è¿˜åŸé»˜è®¤é…ç½®</button>
                    <button @click="showConfig = false" class="btn btn-secondary">å…³é—­</button>
                </div>
            </div>
        </div>
                                        <button class="btn btn-danger" @click="resetAll" :disabled="!imageLoaded">
            é‡ç½®æ‰€æœ‰
        </button>
        <button class="btn btn-info" @click="showConfigDialog">
            é…ç½®
        </button>
                <button class="btn btn-secondary" @click="debugCanvas" :disabled="!imageLoaded">
                    è°ƒè¯•Canvas
        </button>
            </div>
        </div>

                <!-- çŠ¶æ€é¢æ¿ -->
                <div class="status-panel" v-if="status">
                    <h3>ğŸ“Š æœåŠ¡çŠ¶æ€</h3>
                    <div class="status-item">
                        <span class="status-label">æœåŠ¡çŠ¶æ€:</span>
                        <span class="status-value" :class="status.healthy ? 'success' : 'error'">
                            {{ status.healthy ? 'æ­£å¸¸' : 'å¼‚å¸¸' }}
                        </span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ¨¡å‹åŠ è½½:</span>
                        <span class="status-value" :class="status.modelLoaded ? 'success' : 'error'">
                            {{ status.modelLoaded ? 'å·²åŠ è½½' : 'æœªåŠ è½½' }}
                        </span>
                    </div>
                    <div class="status-item" v-if="status.device">
                        <span class="status-label">è®¡ç®—è®¾å¤‡:</span>
                        <span class="status-value" :class="status.device === 'cuda' ? 'success' : 'info'">
                            {{ status.device === 'cuda' ? 'GPUåŠ é€Ÿ' : 'CPU' }}
                        </span>
                    </div>
                    <div class="status-item" v-if="status.gpu_info && status.gpu_info.device_name">
                        <span class="status-label">GPUå‹å·:</span>
                        <span class="status-value">{{ status.gpu_info.device_name }}</span>
                    </div>
                    <div class="status-item" v-if="status.gpu_info && status.gpu_info.memory_allocated">
                        <span class="status-label">GPUå†…å­˜:</span>
                        <span class="status-value">{{ status.gpu_info.memory_allocated }}</span>
                    </div>
                    <div class="status-item" v-if="status.progressive_stats">
                        <span class="status-label">ç½®ä¿¡åº¦é˜ˆå€¼:</span>
                        <span class="status-value">{{ status.progressive_stats.confidence_threshold }}</span>
                    </div>
                    <div class="status-item" v-if="status.progressive_stats">
                        <span class="status-label">æ©ç é˜ˆå€¼:</span>
                        <span class="status-value">{{ status.progressive_stats.mask_threshold }}</span>
                    </div>
                    <div class="status-item" v-if="status.progressive_stats">
                        <span class="status-label">ç¨³å®šæ€§é˜ˆå€¼:</span>
                        <span class="status-value">{{ status.progressive_stats.stability_score_threshold }}</span>
                    </div>
                    <div class="status-item" v-if="status.progressive_stats">
                        <span class="status-label">æœ€å°é¢ç§¯é˜ˆå€¼:</span>
                        <span class="status-value">{{ status.progressive_stats.min_area_threshold }}</span>
                    </div>
                    <div class="status-item" v-if="status.progressive_stats">
                        <span class="status-label">é«˜è´¨é‡token:</span>
                        <span class="status-value" :class="status.progressive_stats.use_hq_token ? 'success' : 'info'">
                            {{ status.progressive_stats.use_hq_token ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                        </span>
                    </div>
                    <div class="status-item" v-if="status.progressive_stats">
                        <span class="status-label">å¤šæ©ç è¾“å‡º:</span>
                        <span class="status-value" :class="status.progressive_stats.multimask_output ? 'success' : 'info'">
                            {{ status.progressive_stats.multimask_output ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                        </span>
                    </div>
                    <div class="status-item" v-if="imageLoaded">
                        <span class="status-label">å›¾åƒå°ºå¯¸:</span>
                        <span class="status-value">{{ imageSize.width }} Ã— {{ imageSize.height }}</span>
                    </div>
                    <div class="points-info" v-if="pointsCount > 0">
                        <h4>ç‚¹å‡»ç‚¹ç»Ÿè®¡</h4>
                        <span class="point-count">æ­£ç‚¹: {{ foregroundCount }}</span>
                        <span class="point-count background">è´Ÿç‚¹: {{ backgroundCount }}</span>
                        <span class="point-count">æ€»è®¡: {{ pointsCount }}</span>
                    </div>
                </div>

                <!-- Canvasäº¤äº’åŒºåŸŸ -->
                <div class="canvas-container">
                    <h3>ğŸ¨ äº¤äº’å¼åˆ†å‰²ç”»å¸ƒ</h3>
                    <div v-if="imageLoaded" class="canvas-wrapper">
                        <canvas 
                            ref="canvas" 
                            :width="canvasWidth" 
                            :height="canvasHeight"
                            @click="handleCanvasClick"
                            @mousemove="handleMouseMove"
                            @mouseleave="handleMouseLeave">
                        </canvas>
                    </div>
                    <div v-else class="canvas-placeholder">
                        <div>
                            <p>è¯·å…ˆä¸Šä¼ å¹¶åŠ è½½å›¾åƒ</p>
                            <p>ç‚¹å‡»ç”»å¸ƒè¿›è¡Œåˆ†å‰²</p>
                        </div>
                    </div>
                </div>

                <!-- ç‚¹å‡»ç±»å‹æ§åˆ¶åŒºåŸŸ -->
                <div v-if="imageLoaded" class="control-panel" style="margin-top: 20px;">
                    <div class="panel">
                        <h3>ğŸ¯ ç‚¹å‡»ç±»å‹é€‰æ‹©</h3>
                        <div class="form-group">
                            <label>é€‰æ‹©ç‚¹å‡»ç±»å‹:</label>
                            <div class="point-type-buttons" style="display: flex; gap: 10px; margin-top: 10px;">
                                <button 
                                    type="button" 
                                    class="btn" 
                                    :class="{ 'active': pointType === 'foreground' }"
                                    @click="pointType = 'foreground'">
                                    ğŸ”´ æ­£ç‚¹ï¼ˆå‰æ™¯ï¼‰
                                </button>
                                <button 
                                    type="button" 
                                    class="btn" 
                                    :class="{ 'active': pointType === 'background' }"
                                    @click="pointType = 'background'">
                                    ğŸ”µ è´Ÿç‚¹ï¼ˆèƒŒæ™¯ï¼‰
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å½“å‰é€‰æ‹©: <span style="color: #667eea; font-weight: bold;">{{ pointType === 'foreground' ? 'æ­£ç‚¹ï¼ˆå‰æ™¯ï¼‰' : 'è´Ÿç‚¹ï¼ˆèƒŒæ™¯ï¼‰' }}</span></label>
                        </div>
                        <div class="form-group" style="border-top: 1px solid #e9ecef; padding-top: 15px; margin-top: 15px;">
                            <label style="color: #495057; font-weight: bold; margin-bottom: 10px;">æ“ä½œæ§åˆ¶:</label>
                            <div style="display: flex; gap: 10px; margin-top: 5px;">
                                <button class="btn btn-secondary" @click="clearPoints" :disabled="!imageLoaded" style="padding: 12px 20px; font-size: 14px; font-weight: bold; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰ç‚¹
                                </button>
                                <button class="btn btn-warning" @click="finishTask" style="padding: 12px 20px; font-size: 14px; font-weight: bold; background: #ffc107; color: #212529; border: none; border-radius: 8px; cursor: pointer;">
                                    ğŸ ç»“æŸä»»åŠ¡
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ¶ˆæ¯æç¤º -->
                <div v-if="message" class="alert" :class="messageType">
                    {{ message }}
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½æˆåŠŸ
        function checkLibrariesLoaded() {
            if (typeof Vue === 'undefined') {
                console.error('Vue.js åŠ è½½å¤±è´¥');
                document.body.innerHTML = `
                    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif; background: white; margin: 20px; border-radius: 10px;">
                        <h1 style="color: #dc3545;">âš ï¸ åº“åŠ è½½å¤±è´¥</h1>
                        <p>æ— æ³•åŠ è½½Vue.jsåº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                        <ul style="text-align: left; max-width: 400px; margin: 20px auto;">
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>å°è¯•ä½¿ç”¨VPN</li>
                            <li>è”ç³»ç½‘ç»œç®¡ç†å‘˜</li>
                            <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                        </ul>
                        <button onclick="location.reload()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">åˆ·æ–°é¡µé¢</button>
                    </div>
                `;
                return false;
            }
            
            if (typeof axios === 'undefined') {
                console.error('Axios åŠ è½½å¤±è´¥');
                document.body.innerHTML = `
                    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif; background: white; margin: 20px; border-radius: 10px;">
                        <h1 style="color: #dc3545;">âš ï¸ åº“åŠ è½½å¤±è´¥</h1>
                        <p>æ— æ³•åŠ è½½Axiosåº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                        <ul style="text-align: left; max-width: 400px; margin: 20px auto;">
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>å°è¯•ä½¿ç”¨VPN</li>
                            <li>è”ç³»ç½‘ç»œç®¡ç†å‘˜</li>
                            <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                        </ul>
                        <button onclick="location.reload()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">åˆ·æ–°é¡µé¢</button>
                    </div>
                `;
                return false;
            }
            
            return true;
        }

        // ç­‰å¾…åº“åŠ è½½å®Œæˆ
        setTimeout(function() {
            if (checkLibrariesLoaded()) {
                const { createApp } = Vue;

                createApp({
                            data() {
                return {
                    // APIé…ç½®
                    apiBaseUrl: 'http://js1.blockelite.cn:34964/api',
                    // apiBaseUrl: 'http://localhost:8801/api',
                    
                    // ä»»åŠ¡é…ç½®
                    taskId: null, // ç”±åç«¯ç”Ÿæˆ
                    
                    // æ–‡ä»¶ç›¸å…³
                    selectedFile: null,
                    originalImage: null,
                    
                    // Canvasç›¸å…³
                    canvas: null,
                    ctx: null,
                    canvasWidth: 400,
                    canvasHeight: 300,
                    
                    // å›¾åƒå’Œè’™ç‰ˆ
                    imageElement: null,
                    maskOverlay: null,
                    
                    // ç‚¹å‡»ç‚¹
                    points: [],
                    pointLabels: [],
                    
                    // å‚æ•°è®¾ç½®
                    maxSize: 1024,
                    quality: 85,
                    pointType: 'foreground',
                    alpha: 0.5,
                    maskAlpha: 128,
                    
                    // çŠ¶æ€
                    loading: false,
                showConfig: false,
                config: {
                    confidence_threshold: 0.5,
                    mask_threshold: 0.0,
                    stability_score_threshold: 0.95,
                    min_area_threshold: 0,
                    use_hq_token: false,
                    multimask_output: false,
                    enable_gpu_preprocessing: true
                },
                    imageLoaded: false,
                    imageSize: { width: 0, height: 0 },
                    pointsCount: 0,
                    foregroundCount: 0,
                    backgroundCount: 0,
                    
                    // æ¶ˆæ¯
                    message: '',
                    messageType: 'info',
                    
                    // æœåŠ¡çŠ¶æ€
                    status: null
                }
            },
            
            mounted() {
                this.checkHealth();
                // å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
                setInterval(() => {
                    this.checkHealth();
                }, 10000);
            },
            
            methods: {
                // æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
                async checkHealth() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/health`);
                        this.status = {
                            healthy: response.data.status === 'healthy',
                            modelLoaded: response.data.model_loaded,
                            device: response.data.device,
                            gpu_info: response.data.gpu_info,
                            progressive_stats: response.data.progressive_stats,
                            preprocessing_stats: response.data.preprocessing_stats
                        };
                    } catch (error) {
                        this.status = {
                            healthy: false,
                            modelLoaded: false
                        };
                    }
                },
                
                // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.selectedFile = file;
                        this.showMessage('æ–‡ä»¶å·²é€‰æ‹©: ' + file.name, 'info');
                    }
                },
                
                // åŠ è½½å›¾åƒ
                async loadImage() {
                    if (!this.selectedFile) {
                        this.showMessage('è¯·å…ˆé€‰æ‹©å›¾åƒæ–‡ä»¶', 'error');
                        return;
                    }
                    
                    this.loading = true;
                    this.showMessage('æ­£åœ¨åŠ è½½å›¾åƒ...', 'info');
                    
                    try {
                        // è½¬æ¢æ–‡ä»¶ä¸ºbase64
                        const base64 = await this.fileToBase64(this.selectedFile);
                        
                        const response = await axios.post(`${this.apiBaseUrl}/load_image`, {
                            image: base64,
                            max_size: this.maxSize,
                            quality: this.quality,
                            taskId: this.taskId || 'default'
                        });
                        
                        if (response.data.success) {
                            // ä¿å­˜åç«¯è¿”å›çš„ä»»åŠ¡ID
                            this.taskId = response.data.taskId || 'default';
                            this.imageLoaded = true;
                            this.imageSize = response.data.image_size;
                            this.points = [];
                            this.pointLabels = [];
                            this.pointsCount = 0;
                            this.foregroundCount = 0;
                            this.backgroundCount = 0;
                            this.maskOverlay = null;
                            
                            console.log('å¼€å§‹åŠ è½½å›¾åƒåˆ°Canvas...');
                            // åŠ è½½å›¾åƒåˆ°Canvas
                            await this.loadImageToCanvas();
                            console.log('Canvaså›¾åƒåŠ è½½å®Œæˆ');
                            
                            this.showMessage(response.data.message, 'success');
                        } else {
                            this.showMessage('åŠ è½½å›¾åƒå¤±è´¥', 'error');
                        }
                    } catch (error) {
                        console.error('åŠ è½½å›¾åƒé”™è¯¯:', error);
                        this.showMessage('åŠ è½½å›¾åƒå¤±è´¥: ' + (error.response?.data?.error || error.message), 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // åŠ è½½å›¾åƒåˆ°Canvas
                async loadImageToCanvas() {
                    return new Promise((resolve) => {
                        this.$nextTick(() => {
                            this.canvas = this.$refs.canvas;
                            this.ctx = this.canvas.getContext('2d');
                            
                            // åˆ›å»ºå›¾åƒå…ƒç´ 
                            this.imageElement = new Image();
                            this.imageElement.crossOrigin = 'anonymous';
                            
                            this.imageElement.onload = () => {
                                console.log('å›¾åƒåŠ è½½æˆåŠŸ:', this.imageElement.width, 'x', this.imageElement.height);
                                
                                // è®¡ç®—Canvaså°ºå¯¸ï¼Œé™åˆ¶æœ€å¤§å°ºå¯¸
                                const maxSize = 1024; // ä¸åç«¯å¤„ç†å°ºå¯¸ä¿æŒä¸€è‡´
                                let canvasWidth = this.imageElement.width;
                                let canvasHeight = this.imageElement.height;
                                
                                if (canvasWidth > maxSize || canvasHeight > maxSize) {
                                    const scale = maxSize / Math.max(canvasWidth, canvasHeight);
                                    canvasWidth = Math.round(canvasWidth * scale);
                                    canvasHeight = Math.round(canvasHeight * scale);
                                }
                                
                                this.canvasWidth = canvasWidth;
                                this.canvasHeight = canvasHeight;
                                this.canvas.width = this.canvasWidth;
                                this.canvas.height = this.canvasHeight;
                                
                                // é‡æ–°è·å–contextï¼ˆå› ä¸ºæ”¹å˜Canvaså°ºå¯¸ä¼šé‡ç½®contextï¼‰
                                this.ctx = this.canvas.getContext('2d');
                                
                                // ç«‹å³ç»˜åˆ¶å›¾åƒ
                                this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
                                this.ctx.drawImage(this.imageElement, 0, 0, this.canvasWidth, this.canvasHeight);
                                console.log('åŸå›¾å·²ç»˜åˆ¶åˆ°Canvasï¼Œå°ºå¯¸:', this.canvasWidth, 'x', this.canvasHeight);
                                
                                // å¼ºåˆ¶é‡ç»˜
                                this.$nextTick(() => {
                                    this.drawImage();
                                });
                                
                                resolve();
                            };
                            
                            this.imageElement.onerror = (error) => {
                                console.error('å›¾åƒåŠ è½½å¤±è´¥:', error);
                                this.showMessage('å›¾åƒåŠ è½½å¤±è´¥', 'error');
                            };
                            
                            // ä½¿ç”¨åŸå§‹æ–‡ä»¶åˆ›å»ºURL
                            this.imageElement.src = URL.createObjectURL(this.selectedFile);
                        });
                    });
                },
                
                // ç»˜åˆ¶å›¾åƒ
                drawImage() {
                    console.log('å¼€å§‹ç»˜åˆ¶å›¾åƒ:', this.canvasWidth, 'x', this.canvasHeight);
                    console.log('å›¾åƒå…ƒç´ å­˜åœ¨:', !!this.imageElement);
                    console.log('Canvaså…ƒç´ å­˜åœ¨:', !!this.canvas);
                    console.log('Contextå­˜åœ¨:', !!this.ctx);
                    
                    if (!this.ctx || !this.imageElement) {
                        console.error('Canvasæˆ–å›¾åƒå…ƒç´ ä¸å­˜åœ¨');
                        return;
                    }
                    
                    // æ¸…é™¤Canvas
                    this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
                    
                    // ç»˜åˆ¶åŸå›¾
                    this.ctx.drawImage(this.imageElement, 0, 0, this.canvasWidth, this.canvasHeight);
                    console.log('åŸå›¾ç»˜åˆ¶å®Œæˆ');
                    
                    // ç»˜åˆ¶è’™ç‰ˆ
                    if (this.maskOverlay) {
                        this.drawMaskOverlay();
                    }
                    
                    // ç»˜åˆ¶ç‚¹å‡»ç‚¹
                    this.drawPoints();
                },
                
                // æ›´æ–°Canvasæ˜¾ç¤ºï¼ˆåç«¯è¿”å›çš„æ˜¯äºŒå€¼è’™ç‰ˆï¼Œåªæ˜¾ç¤ºè’™ç‰ˆä¸­çš„ç™½è‰²éƒ¨åˆ†ï¼‰
                updateCanvasWithMask() {
                    if (!this.maskOverlay) return;
                    
                    const maskImage = new Image();
                    maskImage.onload = () => {
                        // å…ˆç»˜åˆ¶åŸå›¾
                        this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
                        this.ctx.drawImage(this.imageElement, 0, 0, this.canvasWidth, this.canvasHeight);
                        
                        // åˆ›å»ºä¸´æ—¶Canvasæ¥å¤„ç†è’™ç‰ˆ
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = this.canvasWidth;
                        tempCanvas.height = this.canvasHeight;
                        const tempCtx = tempCanvas.getContext('2d');
                        
                        // åœ¨ä¸´æ—¶Canvasä¸Šç»˜åˆ¶è’™ç‰ˆ
                        tempCtx.drawImage(maskImage, 0, 0, this.canvasWidth, this.canvasHeight);
                        
                        // è·å–è’™ç‰ˆæ•°æ®
                        const maskData = tempCtx.getImageData(0, 0, this.canvasWidth, this.canvasHeight);
                        const data = maskData.data;
                        
                        // åˆ›å»ºçº¢è‰²é«˜äº®å±‚
                        const highlightCanvas = document.createElement('canvas');
                        highlightCanvas.width = this.canvasWidth;
                        highlightCanvas.height = this.canvasHeight;
                        const highlightCtx = highlightCanvas.getContext('2d');
                        
                        // è®¾ç½®çº¢è‰²åŠé€æ˜å¡«å……
                        highlightCtx.fillStyle = 'rgba(255, 0, 0, 0.5)';
                        highlightCtx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);
                        
                        // è·å–é«˜äº®å±‚æ•°æ®
                        const highlightData = highlightCtx.getImageData(0, 0, this.canvasWidth, this.canvasHeight);
                        const highlightPixels = highlightData.data;
                        
                        // åˆå¹¶è’™ç‰ˆå’Œé«˜äº®å±‚ï¼šåªåœ¨è’™ç‰ˆä¸ºç™½è‰²ï¼ˆ255ï¼‰çš„åœ°æ–¹æ˜¾ç¤ºçº¢è‰²é«˜äº®
                        for (let i = 0; i < data.length; i += 4) {
                            const maskValue = data[i]; // è’™ç‰ˆçš„ç°åº¦å€¼
                            if (maskValue > 128) { // ç™½è‰²éƒ¨åˆ†ï¼ˆåˆ†å‰²å‡ºçš„å¯¹è±¡ï¼‰
                                // ä¿æŒçº¢è‰²é«˜äº®
                                highlightPixels[i] = 255;     // R
                                highlightPixels[i + 1] = 0;   // G
                                highlightPixels[i + 2] = 0;   // B
                                highlightPixels[i + 3] = this.maskAlpha; // A (å¯è°ƒèŠ‚é€æ˜åº¦)
                            } else {
                                // é€æ˜ï¼ˆä¸æ˜¾ç¤ºï¼‰
                                highlightPixels[i + 3] = 0;
                            }
                        }
                        
                        // å°†å¤„ç†åçš„é«˜äº®å±‚ç»˜åˆ¶åˆ°ä¸»Canvas
                        highlightCtx.putImageData(highlightData, 0, 0);
                        this.ctx.drawImage(highlightCanvas, 0, 0);
                        
                        // ç»˜åˆ¶ç‚¹å‡»ç‚¹
                        this.drawPoints();
                        console.log('Canvasæ›´æ–°å®Œæˆ - åªæ˜¾ç¤ºè’™ç‰ˆç™½è‰²éƒ¨åˆ†');
                    };
                    maskImage.onerror = (error) => {
                        console.error('è’™ç‰ˆåŠ è½½å¤±è´¥:', error);
                        this.showMessage('è’™ç‰ˆåŠ è½½å¤±è´¥', 'error');
                    };
                    maskImage.src = this.maskOverlay;
                },
                
                // ç»˜åˆ¶ç‚¹å‡»ç‚¹
                drawPoints() {
                    this.points.forEach((point, index) => {
                        const [x, y] = point;
                        const isForeground = this.pointLabels[index] === 1;
                        
                        // ç»˜åˆ¶åœ†å½¢ç‚¹
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, 8, 0, 2 * Math.PI);
                        this.ctx.fillStyle = isForeground ? 'red' : 'blue';
                        this.ctx.fill();
                        this.ctx.strokeStyle = 'white';
                        this.ctx.lineWidth = 2;
                        this.ctx.stroke();
                        
                        // ç»˜åˆ¶æ•°å­—æ ‡ç­¾
                        this.ctx.fillStyle = 'white';
                        this.ctx.font = '12px Arial';
                        this.ctx.textAlign = 'center';
                        this.ctx.textBaseline = 'middle';
                        this.ctx.fillText(index + 1, x + 10, y - 10);
                    });
                },
                
                // å¤„ç†Canvasç‚¹å‡»
                async handleCanvasClick(event) {
                    if (!this.imageLoaded) {
                        this.showMessage('è¯·å…ˆåŠ è½½å›¾åƒ', 'error');
                        return;
                    }
                    
                    const rect = this.canvas.getBoundingClientRect();
                    const x = Math.round(event.clientX - rect.left);
                    const y = Math.round(event.clientY - rect.top);
                    
                    this.showMessage(`æ­£åœ¨å¤„ç†ç‚¹å‡» (${x}, ${y})...`, 'info');
                    
                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/segment`, {
                            x: x,
                            y: y,
                            taskId: this.taskId,
                            point_type: this.pointType
                        });
                        
                        if (response.data.success) {
                            // æ·»åŠ ç‚¹å‡»ç‚¹
                            this.points.push([x, y]);
                            this.pointLabels.push(this.pointType === 'foreground' ? 1 : 0);
                            
                            // æ›´æ–°è’™ç‰ˆ
                            this.maskOverlay = 'data:image/png;base64,' + response.data.mask;
                            
                            // æ›´æ–°ç»Ÿè®¡
                            this.pointsCount = response.data.points.total_count;
                            this.foregroundCount = response.data.points.foreground_count;
                            this.backgroundCount = response.data.points.background_count;
                            
                            // ç«‹å³æ›´æ–°Canvasæ˜¾ç¤º
                            this.updateCanvasWithMask();
                            
                            this.showMessage(response.data.message, 'success');
                        } else {
                            this.showMessage('åˆ†å‰²å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        console.error('åˆ†å‰²é”™è¯¯:', error);
                        this.showMessage('åˆ†å‰²å¤±è´¥: ' + (error.response?.data?.error || error.message), 'error');
                    }
                },
                
                // å¤„ç†é¼ æ ‡ç§»åŠ¨
                handleMouseMove(event) {
                    if (!this.imageLoaded) return;
                    
                    const rect = this.canvas.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;
                    
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é¼ æ ‡æ‚¬åœæ•ˆæœ
                },
                
                // å¤„ç†é¼ æ ‡ç¦»å¼€
                handleMouseLeave() {
                    // å¯ä»¥åœ¨è¿™é‡Œæ¸…é™¤é¼ æ ‡æ‚¬åœæ•ˆæœ
                },
                
                // æ¸…é™¤ç‚¹å‡»ç‚¹
                async clearPoints() {
                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/clear_points`, {
                            taskId: this.taskId
                        });
                        if (response.data.success) {
                            this.points = [];
                            this.pointLabels = [];
                            this.pointsCount = 0;
                            this.foregroundCount = 0;
                            this.backgroundCount = 0;
                            this.maskOverlay = null;
                            
                            // é‡æ–°ç»˜åˆ¶åŸå›¾
                            this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
                            this.ctx.drawImage(this.imageElement, 0, 0, this.canvasWidth, this.canvasHeight);
                            
                            this.showMessage(response.data.message, 'success');
                        }
                    } catch (error) {
                        console.error('æ¸…é™¤ç‚¹å‡»ç‚¹é”™è¯¯:', error);
                        this.showMessage('æ¸…é™¤å¤±è´¥: ' + (error.response?.data?.error || error.message), 'error');
                    }
                },
                
                // é‡ç½®æ‰€æœ‰
                resetAll() {
                    this.selectedFile = null;
                    this.originalImage = null;
                    this.imageElement = null;
                    this.maskOverlay = null;
                    this.points = [];
                    this.pointLabels = [];
                    this.imageLoaded = false;
                    this.pointsCount = 0;
                    this.foregroundCount = 0;
                    this.backgroundCount = 0;
                    this.imageSize = { width: 0, height: 0 };
                    this.taskId = null; // é‡ç½®ä»»åŠ¡ID
                    this.showMessage('å·²é‡ç½®æ‰€æœ‰æ•°æ®', 'info');
                },
                
                // è°ƒè¯•Canvas
                debugCanvas() {
                    console.log('Canvasè°ƒè¯•ä¿¡æ¯:');
                    console.log('- Canvaså…ƒç´ :', this.canvas);
                    console.log('- Canvaså°ºå¯¸:', this.canvasWidth, 'x', this.canvasHeight);
                    console.log('- å›¾åƒå…ƒç´ :', this.imageElement);
                    console.log('- å›¾åƒå°ºå¯¸:', this.imageElement?.width, 'x', this.imageElement?.height);
                    console.log('- ç‚¹å‡»ç‚¹æ•°é‡:', this.points.length);
                    
                    // å¼ºåˆ¶é‡æ–°ç»˜åˆ¶åŸå›¾
                    if (this.imageElement) {
                        this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
                        this.ctx.drawImage(this.imageElement, 0, 0, this.canvasWidth, this.canvasHeight);
                        console.log('Canvaså·²é‡æ–°ç»˜åˆ¶åŸå›¾');
                        this.showMessage('Canvaså·²é‡æ–°ç»˜åˆ¶åŸå›¾', 'info');
                    } else {
                        this.showMessage('å›¾åƒå…ƒç´ ä¸å­˜åœ¨', 'error');
                    }
                    
                    // å¦‚æœæœ‰è’™ç‰ˆï¼Œä¹Ÿæ˜¾ç¤ºè’™ç‰ˆ
                    if (this.maskOverlay) {
                        this.updateCanvasWithMask();
                        console.log('Canvaså·²æ›´æ–°è’™ç‰ˆ');
                    }
                },
                
                // æ˜¾ç¤ºé…ç½®å¯¹è¯æ¡†
                async showConfigDialog() {
                    try {
                        // è·å–å½“å‰é…ç½®
                        const [preprocessingResponse, progressiveResponse] = await Promise.all([
                            axios.get(`${this.apiBaseUrl}/preprocessing_config`),
                            axios.get(`${this.apiBaseUrl}/progressive_config`)
                        ]);
                        
                        if (preprocessingResponse.data.success && progressiveResponse.data.success) {
                            // æ›´æ–°æœ¬åœ°é…ç½®
                            this.config.enable_gpu_preprocessing = preprocessingResponse.data.config.enable_gpu_preprocessing;
                            this.config.confidence_threshold = progressiveResponse.data.config.confidence_threshold;
                            this.config.mask_threshold = progressiveResponse.data.config.mask_threshold;
                            this.config.stability_score_threshold = progressiveResponse.data.config.stability_score_threshold;
                            this.config.min_area_threshold = progressiveResponse.data.config.min_area_threshold;
                            this.config.use_hq_token = progressiveResponse.data.config.use_hq_token;
                            this.config.multimask_output = progressiveResponse.data.config.multimask_output;
                        }
                    } catch (error) {
                        console.error('è·å–é…ç½®å¤±è´¥:', error);
                        this.showMessage('è·å–é…ç½®å¤±è´¥', 'error');
                    }
                    
                    this.showConfig = true;
                },
                
                // é‡ç½®ä»»åŠ¡ID
                resetTaskId() {
                    this.taskId = null;
                },
                
                // æ›´æ–°é…ç½®
                async updateConfig() {
                    try {
                        // åˆ†åˆ«æ›´æ–°é¢„å¤„ç†é…ç½®å’Œæ¸è¿›å¼é…ç½®
                        const preprocessingConfig = {
                            enable_gpu_preprocessing: this.config.enable_gpu_preprocessing
                        };
                        
                        const progressiveConfig = {
                            confidence_threshold: this.config.confidence_threshold,
                            mask_threshold: this.config.mask_threshold,
                            stability_score_threshold: this.config.stability_score_threshold,
                            min_area_threshold: this.config.min_area_threshold,
                            use_hq_token: this.config.use_hq_token,
                            multimask_output: this.config.multimask_output
                        };
                        
                        // æ›´æ–°é¢„å¤„ç†é…ç½®
                        await axios.post(`${this.apiBaseUrl}/preprocessing_config`, preprocessingConfig);
                        
                        // æ›´æ–°æ¸è¿›å¼é…ç½®
                        await axios.post(`${this.apiBaseUrl}/progressive_config`, progressiveConfig);
                        
                        this.showMessage('é…ç½®å·²æ›´æ–°', 'success');
                        this.showConfig = false;
                        
                        // åˆ·æ–°é¡µé¢ä»¥æ˜¾ç¤ºæœ€æ–°é…ç½®
                        location.reload();
                    } catch (error) {
                        console.error('é…ç½®æ›´æ–°å¤±è´¥:', error);
                        this.showMessage('é…ç½®æ›´æ–°å¤±è´¥: ' + (error.response?.data?.error || error.message), 'error');
                    }
                },
                
                // ç»“æŸä»»åŠ¡
                async finishTask() {
                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/finish`, {
                            taskId: this.taskId
                        });
                        if (response.data.success) {
                            this.showMessage(response.data.message, 'success');
                            console.log('ä»»åŠ¡ç»“æŸç»“æœ:', response.data);
                            // é‡ç½®çŠ¶æ€
                            this.imageLoaded = false;
                            this.points = [];
                            this.pointLabels = [];
                            this.taskId = null;
                        }
                    } catch (error) {
                        console.error('ç»“æŸä»»åŠ¡å¤±è´¥:', error);
                        this.showMessage('ç»“æŸä»»åŠ¡å¤±è´¥: ' + (error.response?.data?.error || error.message), 'error');
                    }
                },
                
                // è¿˜åŸé»˜è®¤é…ç½®
                async resetToDefault() {
                    try {
                        // è®¾ç½®é»˜è®¤é…ç½®
                        const defaultProgressiveConfig = {
                            confidence_threshold: 0.5,
                            mask_threshold: 0.0,
                            stability_score_threshold: 0.95,
                            min_area_threshold: 0,
                            use_hq_token: false,
                            multimask_output: false
                        };
                        
                        const defaultPreprocessingConfig = {
                            enable_gpu_preprocessing: true
                        };
                        
                        // æ›´æ–°åç«¯é…ç½®
                        await axios.post(`${this.apiBaseUrl}/progressive_config`, defaultProgressiveConfig);
                        await axios.post(`${this.apiBaseUrl}/preprocessing_config`, defaultPreprocessingConfig);
                        
                        // æ›´æ–°æœ¬åœ°é…ç½®
                        this.config.confidence_threshold = defaultProgressiveConfig.confidence_threshold;
                        this.config.mask_threshold = defaultProgressiveConfig.mask_threshold;
                        this.config.stability_score_threshold = defaultProgressiveConfig.stability_score_threshold;
                        this.config.min_area_threshold = defaultProgressiveConfig.min_area_threshold;
                        this.config.use_hq_token = defaultProgressiveConfig.use_hq_token;
                        this.config.multimask_output = defaultProgressiveConfig.multimask_output;
                        this.config.enable_gpu_preprocessing = defaultPreprocessingConfig.enable_gpu_preprocessing;
                        
                        this.showMessage('å·²è¿˜åŸé»˜è®¤é…ç½®', 'success');
                        
                        // åˆ·æ–°é¡µé¢ä»¥æ˜¾ç¤ºæœ€æ–°é…ç½®
                        location.reload();
                    } catch (error) {
                        console.error('è¿˜åŸé»˜è®¤é…ç½®å¤±è´¥:', error);
                        this.showMessage('è¿˜åŸé»˜è®¤é…ç½®å¤±è´¥: ' + (error.response?.data?.error || error.message), 'error');
                    }
                },
                
                // æ–‡ä»¶è½¬base64
                fileToBase64(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = () => {
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = error => reject(error);
                    });
                },
                
                // æ›´æ–°è’™ç‰ˆé€æ˜åº¦
                updateMaskTransparency() {
                    if (this.maskOverlay) {
                        this.updateCanvasWithMask();
                    }
                },
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                showMessage(text, type = 'info') {
                    this.message = text;
                    this.messageType = type;
                    setTimeout(() => {
                        this.message = '';
                    }, 5000);
                }
            }
        }).mount('#app');
        }
    }, 3000); // ç­‰å¾…3ç§’ç¡®ä¿åº“åŠ è½½å®Œæˆ
    </script>
</body>
</html> 